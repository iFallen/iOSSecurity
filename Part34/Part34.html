<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454267)"/><meta name="author" content="JuanFelix"/><meta name="created" content="2017-03-15 05:18:42 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-03-15 06:03:57 +0000"/><title>Part34</title></head><body><div><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">In the <a style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; color: rgb(41, 122, 160);" href="http://highaltitudehacks.com/security"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; text-decoration: underline;">previous</span></a> articles, we have seen how applications like Snoop-it can trace method calls specific to the application at runtime. This is very important in deducing the flow of the application. The same process can be performed by using a perl script named <a href="http://Logify.pl">Logify.pl</a> that comes installed with Theos. The script takes input as a header file and generates the hooking code that we can add in our tweak. We can also specify the classes we want to check. Once the tweak is installed on the device, whenever a method for that particular class is called, the tweak logs out the method along with the arguments to syslog. The first step here is to get the header files for a particular application. You can get the header files by using the -H option in class-dump-z. Once the headers folder is generated, you can copy it to your system.</span></p><div><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/958157D8-3322-4EF5-AC13-1BCF572D7537.png" height="236" width="1041"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Now we can use the <a href="http://Logify.pl">Logify.pl</a> script on these header files to generate our tweak. In this case, we are testing on <a style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; color: rgb(41, 122, 160);" href="http://damnvulnerableiosapp.com"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; text-decoration: underline;">Damn Vulnerable iOS application</span></a>. Let’s add all the classes for which we want to log the method calls. In our case, we select three classes for which we want to trace the method calls, ClientSideInjectionVC, JailbreakDetectionVC and DamnVulnerableAppUtilities.<br style="box-sizing: border-box;"/><br/></span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/D28111BB-918B-435F-8135-0AC229CB76A0.png" height="48" width="579"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">This is how our Tweak.xm file looks like.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/0D1DE914-573B-475D-A1E5-402A5E780CDC.png" height="343" width="662"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Now let’s create a tweak and replace its Tweak.xm file with our own. Also, give the filter as the bundle identifier for DVIA, as we only want to trace calls for DVIA. Have a look at the <a style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; color: rgb(41, 122, 160);" href="http://highaltitudehacks.com/2014/04/18/ios-application-security-part-33-writing-tweaks-using-theos-cydia-substrate"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline; text-decoration: underline;">previous</span></a> article if you are new to writing tweaks.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/6B3E8750-B92A-4341-A8E3-E26CCD3315D8.png" height="294" width="650"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Build the package.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/4FB70E43-E450-4AEA-A78B-77E689EFB353.png" height="77" width="938"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Now install it on your device and respring your device.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/44722C45-A464-4E0A-B791-95E3117D7DBA.png" height="178" width="801"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Now check the folder <em style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: italic; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">/Library/MobileSubstrate/DynamicLibraries</em> on your device to see whether the tweak was installed, and sure enough, we can see that it has been installed.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/9025D70F-F33E-47DB-8A10-C7158C197B1B.png" height="291" width="231"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Now run the DVIA app. Make sure your device is connected to your computer and go to Xcode â€”&gt; Window â€”&gt; Organizer â€”&gt; Devices &amp; select your device and click on Console. You will see the DVIAMethodTracer tweak being loaded into your application.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/44D4A22D-4DE7-4409-9576-1696BD8EB9B7.png" height="187" width="859"/></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">And now as you browse around in the application and invoke methods for the particular classes that we have set up Logify for, you will see that these methods are logged along with the value of their arguments.</span></p><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><img src="Part34.resources/6FD0A4AF-2166-48C9-BB8F-B180FE60D7A9.png" height="268" width="947"/></p></div><p style="box-sizing: border-box; padding: 0px; border: 0px; font-family: Montserrat, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; vertical-align: baseline; color: rgb(71, 71, 71); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-size: 14px; vertical-align: baseline;">Logify can be a very useful tool in figuring out the order in which methods are called and hence deducing a lot about the flow of the application.</span></p><br/></div><div><br/></div></body></html>